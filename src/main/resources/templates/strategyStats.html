<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>üìä Strategy Signal Stats</title>

    <!-- Bootstrap & Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f8fa; }
        .ribbon-header {
            position: relative;
            background: linear-gradient(270deg, #1e3c72, #2a5298, #1e3c72);
            background-size: 600% 600%;
            animation: moveGradient 10s ease infinite;
            padding: 1.5rem;
            color: white;
            text-align: center;
            border-bottom: 4px solid #0d6efd;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .ribbon-header h1 { font-size: 2rem; font-weight: 600; margin: 0; }
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .card { border-radius: 1rem; box-shadow: 0 0.75rem 1.5rem rgba(18, 38, 63, 0.03); }
    </style>
</head>
<body>

<div class="ribbon-header w-100">
    <h1>üìä Strategy Signal Stats</h1>
</div>

<div class="container my-5">

    <!-- Strategy Table -->
    <div class="card p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">üìà Strategy-wise Signal Counts</h4>
            <a href="/" class="btn btn-outline-primary">‚¨ÖÔ∏è Back to Home</a>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-striped text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th>Strategy</th>
                    <th>BUY</th>
                    <th>SELL</th>
                    <th>HOLD</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="row : ${strategyStats}">
                    <td th:text="${row.strategy}"></td>
                    <td th:text="${row.BUY}"></td>
                    <td th:text="${row.SELL}"></td>
                    <td th:text="${row.HOLD}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Threshold Controls -->
    <div class="card p-4">
        <h4 class="mb-3">üõ† Adjust Strategy Thresholds</h4>
        <form id="thresholdForm">
            <div class="row">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="threshold1" class="form-label">Threshold Strategy 1</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold1" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold2" class="form-label">Threshold Strategy 2</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold2" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold3" class="form-label">Threshold Strategy 3</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold3" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold4" class="form-label">Threshold Strategy 4</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold4" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold5" class="form-label">Threshold Strategy 5</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold5" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold6" class="form-label">Threshold Strategy 6</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold6" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold7" class="form-label">Threshold Strategy 7</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold7" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="threshold8" class="form-label">Threshold Strategy 8</label>
                        <input type="number" step="0.1" min="0.1" max="10" class="form-control" id="threshold8" required>
                    </div>
                </div>

            </div>
            <div class="d-flex flex-wrap gap-2">
                <button type="button" class="btn btn-success" onclick="submitThresholds()">üíæ Save Thresholds</button>
                <button type="button" class="btn btn-secondary" onclick="loadThresholds()">üîÑ Get Current Thresholds</button>
            </div>
        </form>
    </div>

</div>

<!-- JavaScript -->
<script>
    function submitThresholds() {
        const payload = {};
        for (let i = 1; i <= 8; i++) {
            const field = document.getElementById('threshold' + i);
            const val = field.value.trim();

            if (!val || isNaN(val)) {
                alert(`‚ùå Threshold ${i} must be a valid number.`);
                return;
            }

            payload['threshold' + i] = parseFloat(val);
        }

        fetch('/update-thresholds', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(res => res.text())
          .then(msg => alert("‚úÖ " + msg))
          .catch(err => alert("‚ùå Failed: " + err));
    }

    function loadThresholds() {
        fetch('/current-thresholds')
            .then(res => res.json())
            .then(data => {
                for (let i = 1; i <= 8; i++) {
                    const val = data['threshold' + i] || 1.0;
                    document.getElementById('threshold' + i).value = val;
                }
            })
            .catch(err => console.error("‚ùå Failed to load current thresholds", err));
    }

    // Initial load
    window.addEventListener('DOMContentLoaded', loadThresholds);
</script>

</body>
</html>
